# Linux

## 参考资料

+ [记一次CPU使用率低负载高的排查过程](https://juejin.cn/post/6844904173843005447)
+ [CPU使用率低负载高](http://blog.itpub.net/26736162/viewspace-2686807/)

## 基础知识

> 简述Linux系统如何查看CPU利用率和负载及其含义
>
> 简述Linux中的负载的含义

+ 查看请参考TOP命令；除此之外还可以使用uptime命令；
+ 负载是指CPU在一段时间内running进程和可中断进程的进程统计；
  + running进程：所有资源都准备好，只需要等待CPU调度；
  + 可中断进程：必须等待磁盘等相应事件相应才能继续执行；
+ 负载的数值数字越小越好，一般不会超过CPU核心数*0.7；
+ 同时而言：负载就是需要运行处理但必须等待队列前的进程处理完成的进程；

> 分析CPU使用率低负载高的可能原因

+ 根本原因是等待磁盘IO等事件的进程太多，而被CPU调度的进程很少；
+ 造成CPU使用率低，负载高的原因可能有：
  1. 磁盘读写请求太多，导致大量IO请求等待；
  2. MySQL中存在没有索引的语句或存在死锁情况；
  3. 外接硬盘故障；



简述对Linux内存空间分配的理解

简述对Linux特权级的理解

> 简述对用户态与内核态概念的理解

+ 用户态：是用户程序运行的内存地址空间；内核态：是Linux内核运行的地址空间；
+ 隔离用户和内核的地址空间可以保证，即使用户程序发生崩溃，内核也不会受到影响；
+ 在内核态中可以执行任何的命令，调用一切的资源；
+ 在用户态中只能执行简单的运行，不能会直接调用系统调用；
+ 必须通过系统接口向内核发出指令；
+ 在top命令中的「%CPU」中「us」代表用户态CPU消耗率、「sy」代表内核态的CPU消耗率；



> 简述对用户态和内核切换的理解

+ 用户态和内核态之间的切换开销大，主要有以下几个过程；
  1. 保留用户态线程（上下文、寄存器、用户栈）
  2. 复制用户态参数
  3. 额外的检查
  4. 执行内核态代码
  5. 复制内核态代码执行结果，回到用户态
  6. 恢复用户态线程（上下文、寄存器、用户栈）



> 简述对用户态和内核态区别的理解

+ 处于内核态时，可以执行

> 简述Linux中进程的状态

+ Linux进程的状态有：Running、Interruptiable、Uninterruptiable、Stopped、Zombie
+ Running：对应进程的两种状态，进程在执行(执行)或进程已经准备好执行(就绪)；
+ Interruptiable：代表进程阻塞等待一个事件的发生，如IO操作、资源可用、或其他进程的信号；
+ Uninterruptiable：另一种阻塞态，此状态与可中断状态之间的区别在于，在不可中断状态下，进程直接在硬件条件下等待，因此不会处理任何信号。
+ Stopped：该进程已停止，只有通过另一进程的积极行动才能恢复。例如，正在调试的进程可以处于停止状态。
+ Zombie：进程已终止，但由于某种原因，它的任务结构仍必须在进程表中。



简述Linux文件系统目录的架构

## Shell命令

> 如何查看线程/进程状态

+ 使用ps命令
+ ps -l



> 如何查看负载

+ 使用top命令
+ 使用uptime命令



> 如何统计文件行数的命令

+ 使用 wc -l



> 如何统计文件数目的命令

+ ls/grep/wc综合运用
+ 统计文件数：`ls -l | grep "^-" | wc -l`
+ 统计文件目录：`ls -l | grep "^d" | wc -l`
+ 统计文件数(含子文件夹)：`ls -lR | grep "^-" | wc -l`
+ 统计文件目录(含子文件夹)：`ls -lR | grep "^d" | wc -l`



> 如何查看资源的命令

+ top：实时查看各个进程资源占用情况；
+ uptime：CPU负载情况
+ vmstat：系统上下文切换
+ iostat：磁盘IO使用率
+ free：内存使用情况
+ df：磁盘使用情况
+ ping：网络连接情况
+ netstat：端口占用情况
+ ps：进程状态情况



> 如何用一条命令如何杀掉某个后台进程

+ kill -9 pid



> 如何查看网络状况，如何看日志

+ netstat
+ tcpdump



> 如何在/usr目录下找出大小超过10M的文件

+ `find /usr/ -type f -size +10M`



> 如何在/home目录下找出120 天前被修改过得文件

+ `find /home/ -type f -mtime -120`



> 如何在/var目录下找出90天内未访问过的文件

+ `find /var/ -type f -atime +90`



> 检查Java进程是否存在

+ `ps -ef | grep java `



> Linux下有哪些常见的通配符?

+ 常见通配符

  ```
  |     #管道符，或者（正则）
  >     #输出重定向
  >>    #输出追加重定向
  <     #输入重定向
  <<    #追加输入重定向
  ~     #当前用户家目录
  `` $() #引用命令被执行后的结果
  $     #以。。。结尾（正则）
  ^     #以。。。开头（正则）
  *     #匹配全部字符，通配符
  ？    #任意一个字符，通配符
  #       #注释
  &       #让程序或脚本切换到后台执行
  &&      #并且 同时成立
  []      #表示一个范围（正则，通配符）
  {}      #产生一个序列（通配符）
  .       #当前目录的硬链接
  ..      #上级目录的硬链接
  ```

  ![preview](https://gitee.com/tobing/imagebed/raw/master/v2-8ad24c5e1b91a5741444e98851b94b01_r.jpg)



> 如何查看系统支持的所有信号

+ `kill -l`



> 如何让命令在后台运行

+ 在命令后面使用「&」符号，可以让命令在后台执行；
+ 使用「&」符号后台程序时，如果当前中断关闭(退出当前账号)，程序会停止执行；
+ 这时可以使用「nohup」命令，这样可以使得中断不会影响程序的运行；
+ nohup = no hang up，不挂起。



> 简述df和du的区别

+ df ：检查磁盘空间占用情况，不能查看某个目录占用大小；
+ du：显示文件或目录占用的磁盘大小；



> 简述对grep命令的理解

+ Linux系统中，grep命令是强大的文本搜索工具，可以使用正则表达式搜索文本，并把匹配的行打印出来；

+ grep，全程Global Regular Expression  Print，全局正则表达式打印，使用权限是所有用户；

+ 常见的使用场景

  ```bash
  pattern正则表达式主要参数：
  \： 忽略正则表达式中特殊字符的原有含义。
  ^：匹配正则表达式的开始行。
  $: 匹配正则表达式的结束行。
  <：从匹配正则表达 式的行开始。
  >：到匹配正则表达式的行结束。
  [ ]：单个字符，如[A]即A符合要求 。
  [ - ]：范围，如[A-Z]，即A、B、C一直到Z都符合要求 。。
  ：所有的单个字符。
  ```

  

